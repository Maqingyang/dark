"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var t in e)if(Object.hasOwnProperty.call(e,t))r[t]=e[t];r["default"]=e;return r};Object.defineProperty(exports,"__esModule",{value:true});var address_1=require("./address");var bytes_1=require("./bytes");var hash_1=require("./hash");var keccak256_1=require("./keccak256");var properties_1=require("./properties");var errors=__importStar(require("./errors"));var _curve=null;function getCurve(){if(!_curve){_curve=new elliptic_1.ec("secp256k1")}return _curve}var KeyPair=function(){function e(e){var r=getCurve().keyFromPrivate(bytes_1.arrayify(e));properties_1.defineReadOnly(this,"privateKey",bytes_1.hexlify(r.priv.toArray("be",32)));properties_1.defineReadOnly(this,"publicKey","0x"+r.getPublic(false,"hex"));properties_1.defineReadOnly(this,"compressedPublicKey","0x"+r.getPublic(true,"hex"));properties_1.defineReadOnly(this,"publicKeyBytes",r.getPublic().encode(null,true))}e.prototype.sign=function(e){var r=getCurve().keyFromPrivate(bytes_1.arrayify(this.privateKey));var t=r.sign(bytes_1.arrayify(e),{canonical:true});return{recoveryParam:t.recoveryParam,r:bytes_1.hexZeroPad("0x"+t.r.toString(16),32),s:bytes_1.hexZeroPad("0x"+t.s.toString(16),32),v:27+t.recoveryParam}};return e}();exports.KeyPair=KeyPair;function recoverPublicKey(e,r){var t={r:bytes_1.arrayify(r.r),s:bytes_1.arrayify(r.s)};return"0x"+getCurve().recoverPubKey(bytes_1.arrayify(e),t,r.recoveryParam).encode("hex",false)}exports.recoverPublicKey=recoverPublicKey;function computePublicKey(e,r){var t=bytes_1.arrayify(e);if(t.length===32){var i=new KeyPair(t);if(r){return i.compressedPublicKey}return i.publicKey}else if(t.length===33){if(r){return bytes_1.hexlify(t)}return"0x"+getCurve().keyFromPublic(t).getPublic(false,"hex")}else if(t.length===65){if(!r){return bytes_1.hexlify(t)}return"0x"+getCurve().keyFromPublic(t).getPublic(true,"hex")}errors.throwError("invalid public or private key",errors.INVALID_ARGUMENT,{arg:"key",value:"[REDACTED]"});return null}exports.computePublicKey=computePublicKey;function recoverAddress(e,r){return computeAddress(recoverPublicKey(e,r))}exports.recoverAddress=recoverAddress;function computeAddress(e){var r="0x"+computePublicKey(e).slice(4);return address_1.getAddress("0x"+keccak256_1.keccak256(r).substring(26))}exports.computeAddress=computeAddress;function verifyMessage(e,r){var t=bytes_1.splitSignature(r);var i=hash_1.hashMessage(e);return recoverAddress(i,{r:t.r,s:t.s,recoveryParam:t.recoveryParam})}exports.verifyMessage=verifyMessage;var elliptic_1=require("elliptic");