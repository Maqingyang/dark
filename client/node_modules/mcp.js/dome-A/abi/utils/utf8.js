"use strict";Object.defineProperty(exports,"__esModule",{value:true});var bytes_1=require("./bytes");var UnicodeNormalizationForm;(function(e){e["current"]="";e["NFC"]="NFC";e["NFD"]="NFD";e["NFKC"]="NFKC";e["NFKD"]="NFKD"})(UnicodeNormalizationForm=exports.UnicodeNormalizationForm||(exports.UnicodeNormalizationForm={}));function toUtf8Bytes(e,r){if(r===void 0){r=UnicodeNormalizationForm.current}if(r!=UnicodeNormalizationForm.current){e=e.normalize(r)}var t=[];var o=0;for(var i=0;i<e.length;i++){var n=e.charCodeAt(i);if(n<128){t[o++]=n}else if(n<2048){t[o++]=n>>6|192;t[o++]=n&63|128}else if((n&64512)==55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)==56320){n=65536+((n&1023)<<10)+(e.charCodeAt(++i)&1023);t[o++]=n>>18|240;t[o++]=n>>12&63|128;t[o++]=n>>6&63|128;t[o++]=n&63|128}else{t[o++]=n>>12|224;t[o++]=n>>6&63|128;t[o++]=n&63|128}}return bytes_1.arrayify(t)}exports.toUtf8Bytes=toUtf8Bytes;function toUtf8String(e){e=bytes_1.arrayify(e);var r="";var t=0;while(t<e.length){var o=e[t++];if(o>>7==0){r+=String.fromCharCode(o);continue}if(o>>6==2){continue}var i=null;if(o>>5==6){i=1}else if(o>>4==14){i=2}else if(o>>3==30){i=3}else if(o>>2==62){i=4}else if(o>>1==126){i=5}else{continue}if(t+i>e.length){for(;t<e.length;t++){if(e[t]>>6!=2){break}}if(t!=e.length)continue;return r}var n=o&(1<<8-i-1)-1;var a;for(a=0;a<i;a++){var f=e[t++];if(f>>6!=2){break}n=n<<6|f&63}if(a!=i){t--;continue}if(n<=65535){r+=String.fromCharCode(n);continue}n-=65536;r+=String.fromCharCode((n>>10&1023)+55296,(n&1023)+56320)}return r}exports.toUtf8String=toUtf8String;