"use strict";var __importDefault=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:true});var bn_js_1=__importDefault(require("bn.js"));var bytes_1=require("./bytes");var keccak256_1=require("./keccak256");var rlp_1=require("./rlp");var errors=require("./errors");function getChecksumAddress(r){if(typeof r!=="string"||!r.match(/^0x[0-9A-Fa-f]{40}$/)){errors.throwError("invalid address",errors.INVALID_ARGUMENT,{arg:"address",value:r})}r=r.toLowerCase();var e=r.substring(2).split("");var s=new Uint8Array(40);for(var t=0;t<40;t++){s[t]=e[t].charCodeAt(0)}s=bytes_1.arrayify(keccak256_1.keccak256(s));for(var a=0;a<40;a+=2){if(s[a>>1]>>4>=8){e[a]=e[a].toUpperCase()}if((s[a>>1]&15)>=8){e[a+1]=e[a+1].toUpperCase()}}return"0x"+e.join("")}var MAX_SAFE_INTEGER=9007199254740991;function log10(r){if(Math.log10){return Math.log10(r)}return Math.log(r)/Math.LN10}const ibanLookup={};for(let r=0;r<10;r++){ibanLookup[String(r)]=String(r)}for(let r=0;r<26;r++){ibanLookup[String.fromCharCode(65+r)]=String(10+r)}var safeDigits=Math.floor(log10(MAX_SAFE_INTEGER));function ibanChecksum(r){r=r.toUpperCase();r=r.substring(4)+r.substring(0,2)+"00";var e="";r.split("").forEach(function(r){e+=ibanLookup[r]});while(e.length>=safeDigits){var s=e.substring(0,safeDigits);e=parseInt(s,10)%97+e.substring(s.length)}var t=String(98-parseInt(e,10)%97);while(t.length<2){t="0"+t}return t}function getAddress(r){var e=null;if(typeof r!=="string"){errors.throwError("invalid address",errors.INVALID_ARGUMENT,{arg:"address",value:r})}if(r.match(/^(0x)?[0-9a-fA-F]{40}$/)){if(r.substring(0,2)!=="0x"){r="0x"+r}e=getChecksumAddress(r);if(r.match(/([A-F].*[a-f])|([a-f].*[A-F])/)&&e!==r){errors.throwError("bad address checksum",errors.INVALID_ARGUMENT,{arg:"address",value:r})}}else if(r.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){if(r.substring(2,4)!==ibanChecksum(r)){errors.throwError("bad icap checksum",errors.INVALID_ARGUMENT,{arg:"address",value:r})}e=new bn_js_1.default.BN(r.substring(4),36).toString(16);while(e.length<40){e="0"+e}e=getChecksumAddress("0x"+e)}else{errors.throwError("invalid address",errors.INVALID_ARGUMENT,{arg:"address",value:r})}return e}exports.getAddress=getAddress;function getIcapAddress(r){var e=new bn_js_1.default.BN(getAddress(r).substring(2),16).toString(36).toUpperCase();while(e.length<30){e="0"+e}return"XE"+ibanChecksum("XE00"+e)+e}exports.getIcapAddress=getIcapAddress;function getContractAddress(r){if(!r.from){throw new Error("missing from address")}var e=r.nonce;return getAddress("0x"+keccak256_1.keccak256(rlp_1.encode([getAddress(r.from),bytes_1.stripZeros(bytes_1.hexlify(e))])).substring(26))}exports.getContractAddress=getContractAddress;